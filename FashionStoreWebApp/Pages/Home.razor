@page "/"
@using FashionStoreViewModel;
@using FashionStoreWebApp.Services;
@using FashionStoreWebApp.Helpers;
@using FashionStoreWebApp.Constants;
@using FashionStoreViewModel.Enumerations;

@inject IProductService ProductService;

<PageTitle>Home</PageTitle>

<!-- Product Section Begin -->
<section class="product spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <ul class="filter__controls">
                    <li class="@(PagingProduct.Page == 1 ? "active" : "" )" data-filter="*" @onclick="() => FetchProducts(1)">Best Sellers</li>
                    <li class="@(PagingProduct.Page == 2 ? "active" : "" )" data-filter=".new-arrivals" @onclick="() => FetchProducts(2)">New Arrivals</li>
                    <li class="@(PagingProduct.Page == 3 ? "active" : "" )" data-filter=".hot-sales" @onclick="() => FetchProducts(3)">Hot Sales</li>
                </ul>
            </div>
        </div>
        <div class="row product__filter">
            @foreach (var product in PagingProduct.Items) {
                <div class="col-lg-3 col-md-6 col-sm-6 col-md-6 col-sm-6 mix new-arrivals">
                    <div class="product__item">
                        <div class="product__item__pic set-bg" style="background-image: url('@GetImageUrl(product.ImageUrl)');">
                            <ul class="product__hover">
                                <li><a href="#"><img src="img/icon/heart.png" alt=""></a></li>
                                <li><a href="#"><img src="img/icon/compare.png" alt=""> <span>Compare</span></a></li>
                                <li><a href="#"><img src="img/icon/search.png" alt=""></a></li>
                            </ul>
                        </div>
                        <div class="product__item__text">
                            <h6>@product.Name</h6>
                            <a href="#" class="add-cart">+ Add To Cart</a>
                            <div class="rating">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                            </div>
                            <h5>$@product.Price</h5>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>
<!-- Product Section End -->

@code {
    private int PageSize = 8;
    PagingData<ProductVm> PagingProduct = new PagingData<ProductVm>([], ConstantValues.ZERO, ConstantValues.FIRST_PAGE, 8);

    protected override async Task OnInitializedAsync()
    {
        await FetchProducts(1);
    }

    private string GetImageUrl(string imageName)
    {
        return $"{ConstantValues.BACKEND_URL}/{imageName}";
    }

    private async Task FetchProducts(int pageIndex)
    {
        PagingProduct = await ProductService.SearchProduct(string.Empty, pageIndex, PageSize);
        StateHasChanged();
    }
}